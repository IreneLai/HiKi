<!DOCTYPE html>
<html>
<title>Search</title>
<meta charset="UTF-8">

<!--bootstrap-->
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script>
$(function(){
    var len = 130; // 超過50個字以"..."取代
    $(".JQellipsis").each(function(i){
        if($(this).text().length>len){
            $(this).attr("title",$(this).text());
            var text=$(this).text().substring(0,len-1)+"...";
            $(this).text(text);
        }
    });
});
</script>

<style>
    @import "http://fonts.googleapis.com/css?family=Roboto:300,400,500,700";
    .container { margin-top: 20px; }
    .mb20 { margin-bottom: 20px; } 

    hgroup { padding-left: 15px; border-bottom: 1px solid #ccc; }
    hgroup h1 { font: 500 normal 1.625em "Roboto",Arial,Verdana,sans-serif; color: #2a3644; margin-top: 0; line-height: 1.15; }
    hgroup h2.lead { font: normal normal 1.125em "Roboto",Arial,Verdana,sans-serif; color: #2a3644; margin: 0; padding-bottom: 10px; }

    .search-result .thumbnail { border-radius: 0 !important; }
    .search-result:first-child { margin-top: 0 !important; }
    .search-result { margin-top: 20px; }
    .search-result .col-md-2 { border-right: 1px dotted #ccc; min-height: 150px; }
    .search-result ul { padding-left: 0 !important; list-style: none;  }
    .search-result ul li { font: 400 normal 1em "Roboto",Arial,Verdana,sans-serif;  line-height: 30px; }
    .search-result ul li i { padding-right: 5px; }
    .search-result .col-md-7 { position: relative; }
    .search-result h3 { font: 500 normal 2em "Roboto",Arial,Verdana,sans-serif; margin-top: 0 !important; margin-bottom: 10px !important; }
    .search-result h3 > a, .search-result i { color: #0ABAB5 !important; }
    .search-result p { font: normal normal 1em "Roboto",Arial,Verdana,sans-serif; } 
    .search-result span.plus { position: absolute; right: 0; top: 126px; }
    .search-result span.plus a { background-color: #0ABAB5; padding: 5px 5px 3px 5px; }
    .search-result span.plus a:hover { background-color: #414141; }
    .search-result span.plus a i { color: #fff !important; }
    .search-result span.border { display: block; width: 97%; margin: 0 15px; border-bottom: 1px dotted #ccc; }

    /* Search Box */
    #imaginary_container{
        margin-top:5%; /* Don't copy this */
    }
    .stylish-input-group .input-group-addon{
        background: white !important; 
    }
    .stylish-input-group .form-control{
        border-right:0; 
        box-shadow:0 0 0; 
        border-color:#ccc;
    }
    .stylish-input-group button{
        border:0;
        background:transparent;
    }

    .ellipsis {
        overflow:hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
    }
</style>
<body>


    <div class="container">

        <div class="row">
            <div class="col-sm-6 col-sm-offset-3">
                <form method="post" >
                    {% csrf_token %}
                    <div id="imaginary_container"> 
                        <div class="input-group stylish-input-group">
                            <input type="text" class="form-control" name="search" placeholder="請輸入搜尋文字" >
                            <span class="input-group-addon">
                                <button type="submit">
                                    <span class="glyphicon glyphicon-search"></span>
                                </button>  
                            </span>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <br>
        <br>

        <hgroup class="mb20">
            <h1>搜尋結果</h1>
            <h2 class="lead">找到<strong class="text-danger">{{diaryList|length}}</strong>筆資料
            {% ifnotequal searchList|length 0 %}
            符合：
                {% for s in searchList %}
                    {{s}}
                {% endfor%}	
            {% endifnotequal %}
            </h2>
        </hgroup>

        <section class="col-xs-12 col-sm-6 col-md-12">
            {% for diary in diaryList%}

            <article class="search-result row">
                <div class="col-xs-12 col-sm-12 col-md-3">
                    <a href="#" title="{{diary.title}}" class="thumbnail">
                    {% if diary.media_set.all|length == 0 %}
                        <img style="max-width:250px;height:140px"src="http://lorempixel.com/250/140/nature" alt="nature" /></a>
                    
                    {% else %}
                        <img style="max-width:250px;height:140px" src="{{mediaURL}}{{diary.media_set.first.img}}" alt="{{diary.title}}" /></a>
                    {% endif%}
                </div>
                <div class="col-xs-12 col-sm-12 col-md-2">
                    <ul class="meta-search">
                        <li><i class="glyphicon glyphicon-calendar"></i> <span>{{diary.date}}</span></li>
                        <li><i class="glyphicon glyphicon-user"></i> <span>{{diary.userID.name}}</span></li>
                        {% ifnotequal diary.tags.all|length 0 %}
                            <li><i class="glyphicon glyphicon-tags"></i> 
                            <span>
                                {% for tag in diary.tags.all %}
                                    <button class="ellipsis btn-xs btn" style="max-width:100%">{{tag}}</button>
                                {% endfor%}
                            </span></li>
                        {% endifnotequal %}
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-7 excerpet">
                    <h3>{{diary.title}}</h3>
                    <p class="JQellipsis">{{diary.content}}</p> 
                    <p><a class="" href="{% url 'detail' pk=diary.pk %}" title="進入日記" style="text-decoration: none">... 繼續閱讀</a></p>
                </div>
                <span class="clearfix borda"></span>
            </article>
            <hr>
            {% endfor%}
            		

        </section>
    </div>

</body>
</html>
